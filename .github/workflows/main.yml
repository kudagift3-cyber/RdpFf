name: AvicaRDP

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *' # প্রতি ৬ ঘণ্টা পর পর অটো রিস্টার্ট

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350

    steps:
      - name: Direct Avica Setup
        run: |
          Write-Host "🚀 Starting Avica setup directly..." -ForegroundColor Green
          
          # ফাইলগুলো সরাসরি ডাউনলোড করা হচ্ছে
          try {
            Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py" -ErrorAction Stop
            Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe" -ErrorAction Stop
            Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat" -ErrorAction Stop
            Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat" -ErrorAction Stop
            Write-Host "✅ All files downloaded successfully!" -ForegroundColor Green
          } catch {
            Write-Host "❌ Error downloading files: $($_.Exception.Message)" -ForegroundColor Red
            exit 1
          }
          
          # প্রয়োজনীয় পাইথন প্যাকেজ ইনস্টল
          Write-Host "📦 Installing Python packages..." -ForegroundColor Yellow
          python.exe -m pip install requests pyautogui telegraph --quiet
          
          # RDP চালু করা হচ্ছে - সঠিক Registry Path
          Write-Host "🔧 Enabling RDP..." -ForegroundColor Yellow
          try {
            Set-ItemProperty -Path 'HKLM:SystemCurrentControlSetControlTerminal Server' -Name "fDenyTSConnections" -Value 0 -ErrorAction Stop
            Enable-NetFirewallRule -DisplayGroup "Remote Desktop" -ErrorAction Stop
            Write-Host "✅ RDP enabled successfully!" -ForegroundColor Green
          } catch {
            Write-Host "⚠️ RDP configuration warning: $($_.Exception.Message)" -ForegroundColor Yellow
            # Continue anyway as this might not be critical
          }
          
          # ইউজারের পাসওয়ার্ড সেট করা
          Write-Host "👤 Setting user password..." -ForegroundColor Yellow
          net user runneradmin TheDisa1a
          
          # Avica ইনস্টলেশন শুরু
          Write-Host "⚡ Starting Avica installation..." -ForegroundColor Yellow
          Start-Process "Avica_setup.exe" -WindowStyle Minimized
          
          # ইনস্টলেশনের জন্য অপেক্ষা
          Write-Host "⏳ Waiting for Avica installation..." -ForegroundColor Cyan
          Start-Sleep -Seconds 20
          
          # সব উইন্ডো মিনিমাইজ করা
          Write-Host "🖥️ Minimizing all windows..." -ForegroundColor Cyan
          try {
            (New-Object -ComObject Shell.Application).MinimizeAll()
            Start-Sleep -Seconds 5
          } catch {
            Write-Host "⚠️ Could not minimize windows" -ForegroundColor Yellow
          }
          
          # সেটআপ স্ক্রিপ্ট চালানো
          Write-Host "🔧 Running setup script..." -ForegroundColor Yellow
          python setup.py
          
          Write-Host "✅ Setup completed! Check for GoFile link!" -ForegroundColor Green

      - name: Show Connection Info
        run: |
          Write-Host "
          ╔══════════════════════════════════════╗
          ║         AVICA RDP CONNECTION         ║
          ╚══════════════════════════════════════╝
          
          📱 Telegram : @Aditya_L7
          👨‍💻 Credits : @Aditya_L7
          
          📋 Instructions:
          • Go to the GoFile link that will appear below
          • Get Avica ID and Password from there
          • Download Avica app and connect
          • GoFile link changes every time!
          
          🔑 Default RDP Credentials:
          • Username: runneradmin
          • Password:
